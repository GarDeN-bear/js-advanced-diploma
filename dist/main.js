/*! For license information please see main.js.LICENSE.txt */
(()=>{"use strict";var e={186:(e,t,n)=>{e.exports=n.p+"2429af6d3a5796e3c34b.png"},227:(e,t,n)=>{e.exports=n.p+"f5c75398bcb5931f9f3c.png"},540:e=>{e.exports=function(e){var t=document.createElement("style");return e.setAttributes(t,e.attributes),e.insert(t,e.options),t}},756:(e,t,n)=>{e.exports=n.p+"bf0ed0dca1d1e6091d42.png"},1016:(e,t,n)=>{n.d(t,{A:()=>qe});var r=n(1601),o=n.n(r),a=n(6314),i=n.n(a),c=n(4417),s=n.n(c),l=new URL(n(7935),n.b),u=new URL(n(1409),n.b),f=new URL(n(3232),n.b),h=new URL(n(1265),n.b),p=new URL(n(6267),n.b),d=new URL(n(186),n.b),y=new URL(n(9745),n.b),m=new URL(n(8490),n.b),b=new URL(n(2573),n.b),v=new URL(n(4496),n.b),g=new URL(n(8956),n.b),w=new URL(n(9221),n.b),k=new URL(n(6092),n.b),C=new URL(n(4184),n.b),P=new URL(n(5513),n.b),S=new URL(n(3062),n.b),O=new URL(n(4875),n.b),L=new URL(n(5134),n.b),j=new URL(n(7335),n.b),E=new URL(n(6153),n.b),x=new URL(n(9e3),n.b),T=new URL(n(9593),n.b),R=new URL(n(5523),n.b),G=new URL(n(7986),n.b),I=new URL(n(4041),n.b),M=new URL(n(7538),n.b),U=new URL(n(1605),n.b),_=new URL(n(6318),n.b),$=new URL(n(3933),n.b),A=new URL(n(6291),n.b),z=new URL(n(9702),n.b),D=new URL(n(1906),n.b),B=new URL(n(4347),n.b),N=new URL(n(1216),n.b),F=new URL(n(4437),n.b),q=new URL(n(3160),n.b),H=new URL(n(8341),n.b),W=new URL(n(2076),n.b),J=new URL(n(3860),n.b),Y=new URL(n(6943),n.b),Q=new URL(n(6168),n.b),K=new URL(n(227),n.b),V=new URL(n(756),n.b),X=new URL(n(9334),n.b),Z=i()(o()),ee=s()(l),te=s()(u),ne=s()(f),re=s()(h),oe=s()(p),ae=s()(d),ie=s()(y),ce=s()(m),se=s()(b),le=s()(v),ue=s()(g),fe=s()(w),he=s()(k),pe=s()(C),de=s()(P),ye=s()(S),me=s()(O),be=s()(L),ve=s()(j),ge=s()(E),we=s()(x),ke=s()(T),Ce=s()(R),Pe=s()(G),Se=s()(I),Oe=s()(M),Le=s()(U),je=s()(_),Ee=s()($),xe=s()(A),Te=s()(z),Re=s()(D),Ge=s()(B),Ie=s()(N),Me=s()(F),Ue=s()(q),_e=s()(H),$e=s()(W),Ae=s()(J),ze=s()(Y),De=s()(Q),Be=s()(K),Ne=s()(V),Fe=s()(X);Z.push([e.id,`:root {\n  --cell-size: 64px;\n}\n\nhtml, body {\n  height: 100%;\n  margin: 0;\n}\n\nbody {\n  background: #000;\n  font-size: 16px;\n}\n\n.btn {\n  display: inline-block;\n  font-weight: 400;\n  color: #212529;\n  background-color: #f8f9fa;\n  text-align: center;\n  vertical-align: middle;\n  padding: .375rem .75rem;\n  font-size: 1rem;\n  line-height: 1.5;\n  border-radius: .25rem;\n  transition: color .15s ease-in-out,background-color .15s ease-in-out,border-color .15s ease-in-out,box-shadow .15s ease-in-out;\n  border: none;\n}\n\n.controls {\n  text-align: center;\n  margin: 50px 0;\n}\n\n.board-container {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  flex-wrap: wrap;\n}\n\n.board {\n  display: grid;\n  grid-template-columns: repeat(8, 1fr);\n  grid-column-gap: 2px;\n  grid-row-gap: 2px;\n}\n\n.cell {\n  position: relative;\n}\n\n.cell.selected::before {\n  content: '';\n  display: block;\n  border: 4px;\n  border-radius: 32px;\n  box-sizing: border-box;\n  width: var(--cell-size);\n  height: var(--cell-size);\n  opacity: 0.9;\n  position: absolute;\n}\n\n.cell.selected-yellow::before {\n  border-color: #ff0;\n  border-style: solid;\n}\n\n.cell.selected-green::before {\n  border-color: #0f0;\n  border-style: dashed;\n}\n\n.cell.selected-red::before {\n  border-color: #f00;\n  border-style: dashed;\n}\n\n.board.prairie {\n  --map-tile-top-left-url: url(${ee});\n  --map-tile-top-url: url(${te});\n  --map-tile-top-right-url: url(${ne});\n  --map-tile-bottom-left-url: url(${re});\n  --map-tile-bottom-url: url(${oe});\n  --map-tile-bottom-right-url: url(${ae});\n  --map-tile-left-url: url(${ie});\n  --map-tile-right-url: url(${ce});\n  --map-tile-center-url: url(${se});\n}\n\n.board.desert {\n  --map-tile-top-left-url: url(${le});\n  --map-tile-top-url: url(${ue});\n  --map-tile-top-right-url: url(${fe});\n  --map-tile-bottom-left-url: url(${he});\n  --map-tile-bottom-url: url(${pe});\n  --map-tile-bottom-right-url: url(${de});\n  --map-tile-left-url: url(${ye});\n  --map-tile-right-url: url(${me});\n  --map-tile-center-url: url(${be});\n}\n\n.board.arctic {\n  --map-tile-top-left-url: url(${ve});\n  --map-tile-top-url: url(${ge});\n  --map-tile-top-right-url: url(${we});\n  --map-tile-bottom-left-url: url(${ke});\n  --map-tile-bottom-url: url(${Ce});\n  --map-tile-bottom-right-url: url(${Pe});\n  --map-tile-left-url: url(${Se});\n  --map-tile-right-url: url(${Oe});\n  --map-tile-center-url: url(${Le});\n}\n\n.board.mountain {\n  --map-tile-top-left-url: url(${je});\n  --map-tile-top-url: url(${Ee});\n  --map-tile-top-right-url: url(${xe});\n  --map-tile-bottom-left-url: url(${Te});\n  --map-tile-bottom-url: url(${Re});\n  --map-tile-bottom-right-url: url(${Ge});\n  --map-tile-left-url: url(${Ie});\n  --map-tile-right-url: url(${Me});\n  --map-tile-center-url: url(${Ue});\n}\n\n.map-tile {\n  width: var(--cell-size);\n  height: var(--cell-size);\n}\n\n.map-tile-top-left {\n  background: var(--map-tile-top-left-url);\n}\n\n.map-tile-top {\n  background: var(--map-tile-top-url);\n}\n\n.map-tile-top-right {\n  background: var(--map-tile-top-right-url);\n}\n\n.map-tile-bottom-left {\n  background: var(--map-tile-bottom-left-url);\n}\n\n.map-tile-bottom {\n  background: var(--map-tile-bottom-url);\n}\n\n.map-tile-bottom-right {\n  background: var(--map-tile-bottom-right-url);\n}\n\n.map-tile-left {\n  background: var(--map-tile-left-url);\n}\n\n.map-tile-right {\n  background: var(--map-tile-right-url);\n}\n\n.map-tile-center {\n  background: var(--map-tile-center-url);\n}\n\n.character {\n  width: var(--cell-size);\n  height: var(--cell-size);\n  position: absolute;\n  z-index: 99;\n}\n\n.character.generic {\n  background: url(${_e});\n}\n\n.character.bowman {\n  background: url(${$e});\n}\n\n.character.daemon {\n  background: url(${Ae});\n}\n\n.character.magician {\n  background: url(${ze});\n}\n\n.character.swordsman {\n  background: url(${De});\n}\n\n.character.undead {\n  background: url(${Be});\n}\n\n.character.vampire {\n  background: url(${Ne});\n}\n\n.character.zombie {\n  background: url(${Fe});\n}\n\n.health-level {\n  top: 2px;\n  left: 7px;\n  position: absolute;\n  width: 50px;\n  height: 4px;\n  background: #000;\n}\n\n.health-level-indicator {\n  height: 4px;\n}\n\n.health-level-indicator-high {\n  background: #0f0;\n}\n\n.health-level-indicator-normal {\n  background: #ff0;\n}\n\n.health-level-indicator-critical {\n  background: #f00;\n}\n\n.damage {\n  position: absolute;\n  width: var(--cell-size);\n  text-align: center;\n  z-index: 999;\n  color: #f00;\n  font-weight: bold;\n  animation: 500ms fade ease-out;\n}\n\n@keyframes fade {\n  from {\n    opacity: 0;\n    top: calc(var(--cell-size) * 0.5);\n    font-size: 1rem;\n  }\n  to {\n    opacity: 1;\n    top: -20px;\n    font-size: 1.5rem;\n  }\n}\n`,""]);const qe=Z},1113:e=>{e.exports=function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}}},1216:(e,t,n)=>{e.exports=n.p+"c75f062dddba6e98fdc6.png"},1265:(e,t,n)=>{e.exports=n.p+"26b5f224d8750119922d.png"},1409:(e,t,n)=>{e.exports=n.p+"946aeb948db6313f1d85.png"},1601:e=>{e.exports=function(e){return e[1]}},1605:(e,t,n)=>{e.exports=n.p+"246277b8ca590816b3e8.png"},1906:(e,t,n)=>{e.exports=n.p+"f462d2ed6eedca1e4fd9.png"},2076:(e,t,n)=>{e.exports=n.p+"cec542854b228e61547a.png"},2573:(e,t,n)=>{e.exports=n.p+"0089a610e6611f679b50.png"},3062:(e,t,n)=>{e.exports=n.p+"eb1f6e4f87b977012684.png"},3160:(e,t,n)=>{e.exports=n.p+"6f6f7c09bde970b2e41b.png"},3232:(e,t,n)=>{e.exports=n.p+"0ac7f8258ec7166dc957.png"},3860:(e,t,n)=>{e.exports=n.p+"cf170a9fea1051b7424a.png"},3933:(e,t,n)=>{e.exports=n.p+"8b928c3eb136543e573a.png"},4041:(e,t,n)=>{e.exports=n.p+"3d9503e0a850fda86f82.png"},4184:(e,t,n)=>{e.exports=n.p+"f1703771380a9959d979.png"},4347:(e,t,n)=>{e.exports=n.p+"6bacb8e25ed9ecf726bf.png"},4417:e=>{e.exports=function(e,t){return t||(t={}),e?(e=String(e.__esModule?e.default:e),/^['"].*['"]$/.test(e)&&(e=e.slice(1,-1)),t.hash&&(e+=t.hash),/["'() \t\n]|(%20)/.test(e)||t.needQuotes?'"'.concat(e.replace(/"/g,'\\"').replace(/\n/g,"\\n"),'"'):e):e}},4437:(e,t,n)=>{e.exports=n.p+"26fdc25019c24e87f11a.png"},4496:(e,t,n)=>{e.exports=n.p+"258d884122fabfc2f312.png"},4875:(e,t,n)=>{e.exports=n.p+"2c19971f327b288278bb.png"},5056:(e,t,n)=>{e.exports=function(e){var t=n.nc;t&&e.setAttribute("nonce",t)}},5072:e=>{var t=[];function n(e){for(var n=-1,r=0;r<t.length;r++)if(t[r].identifier===e){n=r;break}return n}function r(e,r){for(var a={},i=[],c=0;c<e.length;c++){var s=e[c],l=r.base?s[0]+r.base:s[0],u=a[l]||0,f="".concat(l," ").concat(u);a[l]=u+1;var h=n(f),p={css:s[1],media:s[2],sourceMap:s[3],supports:s[4],layer:s[5]};if(-1!==h)t[h].references++,t[h].updater(p);else{var d=o(p,r);r.byIndex=c,t.splice(c,0,{identifier:f,updater:d,references:1})}i.push(f)}return i}function o(e,t){var n=t.domAPI(t);return n.update(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap&&t.supports===e.supports&&t.layer===e.layer)return;n.update(e=t)}else n.remove()}}e.exports=function(e,o){var a=r(e=e||[],o=o||{});return function(e){e=e||[];for(var i=0;i<a.length;i++){var c=n(a[i]);t[c].references--}for(var s=r(e,o),l=0;l<a.length;l++){var u=n(a[l]);0===t[u].references&&(t[u].updater(),t.splice(u,1))}a=s}}},5134:(e,t,n)=>{e.exports=n.p+"51e2a5de56bd631452fe.png"},5513:(e,t,n)=>{e.exports=n.p+"5cf9c17d6a1ea7106a6c.png"},5523:(e,t,n)=>{e.exports=n.p+"63aae58e4690953a3857.png"},6092:(e,t,n)=>{e.exports=n.p+"13edb269e39172ddd74f.png"},6153:(e,t,n)=>{e.exports=n.p+"e0aa3daf6d08c62c96d9.png"},6168:(e,t,n)=>{e.exports=n.p+"2007ec00c1d9f997e704.png"},6267:(e,t,n)=>{e.exports=n.p+"07d5e8127645225478b6.png"},6291:(e,t,n)=>{e.exports=n.p+"a1d2321024649b9d8f5f.png"},6314:e=>{e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var n="",r=void 0!==t[5];return t[4]&&(n+="@supports (".concat(t[4],") {")),t[2]&&(n+="@media ".concat(t[2]," {")),r&&(n+="@layer".concat(t[5].length>0?" ".concat(t[5]):""," {")),n+=e(t),r&&(n+="}"),t[2]&&(n+="}"),t[4]&&(n+="}"),n})).join("")},t.i=function(e,n,r,o,a){"string"==typeof e&&(e=[[null,e,void 0]]);var i={};if(r)for(var c=0;c<this.length;c++){var s=this[c][0];null!=s&&(i[s]=!0)}for(var l=0;l<e.length;l++){var u=[].concat(e[l]);r&&i[u[0]]||(void 0!==a&&(void 0===u[5]||(u[1]="@layer".concat(u[5].length>0?" ".concat(u[5]):""," {").concat(u[1],"}")),u[5]=a),n&&(u[2]?(u[1]="@media ".concat(u[2]," {").concat(u[1],"}"),u[2]=n):u[2]=n),o&&(u[4]?(u[1]="@supports (".concat(u[4],") {").concat(u[1],"}"),u[4]=o):u[4]="".concat(o)),t.push(u))}},t}},6318:(e,t,n)=>{e.exports=n.p+"ef1b0ea8c4e545d9aadc.png"},6943:(e,t,n)=>{e.exports=n.p+"c0fa2b75539f94144dc4.png"},7335:(e,t,n)=>{e.exports=n.p+"eab6a2cc5e89a4dd8e3f.png"},7538:(e,t,n)=>{e.exports=n.p+"22e7c5ede3f747cbe27a.png"},7659:e=>{var t={};e.exports=function(e,n){var r=function(e){if(void 0===t[e]){var n=document.querySelector(e);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(e){n=null}t[e]=n}return t[e]}(e);if(!r)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");r.appendChild(n)}},7825:e=>{e.exports=function(e){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var t=e.insertStyleElement(e);return{update:function(n){!function(e,t,n){var r="";n.supports&&(r+="@supports (".concat(n.supports,") {")),n.media&&(r+="@media ".concat(n.media," {"));var o=void 0!==n.layer;o&&(r+="@layer".concat(n.layer.length>0?" ".concat(n.layer):""," {")),r+=n.css,o&&(r+="}"),n.media&&(r+="}"),n.supports&&(r+="}");var a=n.sourceMap;a&&"undefined"!=typeof btoa&&(r+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(a))))," */")),t.styleTagTransform(r,e,t.options)}(t,e,n)},remove:function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(t)}}}},7935:(e,t,n)=>{e.exports=n.p+"46d63299c3420c030b4e.png"},7986:(e,t,n)=>{e.exports=n.p+"ac9d74f57639792774bc.png"},8341:(e,t,n)=>{e.exports=n.p+"0a77fc47d727eab6fd39.png"},8490:(e,t,n)=>{e.exports=n.p+"6a84ae91f5d985ddc9ee.png"},8956:(e,t,n)=>{e.exports=n.p+"dc3f97e7bbcd5ea1ded9.png"},9e3:(e,t,n)=>{e.exports=n.p+"d31d84c693f649766aee.png"},9221:(e,t,n)=>{e.exports=n.p+"2f1e1970c2c20cf3a8d5.png"},9334:(e,t,n)=>{e.exports=n.p+"296dfeac15e2377fc1dc.png"},9593:(e,t,n)=>{e.exports=n.p+"b27323cf850ed820855c.png"},9702:(e,t,n)=>{e.exports=n.p+"1d70f1dab2dd418c3612.png"},9745:(e,t,n)=>{e.exports=n.p+"546abb060a0837550fd1.png"}},t={};function n(r){var o=t[r];if(void 0!==o)return o.exports;var a=t[r]={id:r,exports:{}};return e[r](a,a.exports,n),a.exports}n.m=e,n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e;n.g.importScripts&&(e=n.g.location+"");var t=n.g.document;if(!e&&t&&(t.currentScript&&"SCRIPT"===t.currentScript.tagName.toUpperCase()&&(e=t.currentScript.src),!e)){var r=t.getElementsByTagName("script");if(r.length)for(var o=r.length-1;o>-1&&(!e||!/^http(s?):/.test(e));)e=r[o--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/^blob:/,"").replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),n.p=e})(),n.b=document.baseURI||self.location.href,n.nc=void 0;var r=n(5072),o=n.n(r),a=n(7825),i=n.n(a),c=n(7659),s=n.n(c),l=n(5056),u=n.n(l),f=n(540),h=n.n(f),p=n(1113),d=n.n(p),y=n(1016),m={};function b(e){return b="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},b(e)}function v(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=g(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=!0,c=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return i=e.done,e},e:function(e){c=!0,a=e},f:function(){try{i||null==n.return||n.return()}finally{if(c)throw a}}}}function g(e,t){if(e){if("string"==typeof e)return w(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?w(e,t):void 0}}function w(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function k(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,C(r.key),r)}}function C(e){var t=function(e){if("object"!=b(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=b(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==b(t)?t:t+""}m.styleTagTransform=d(),m.setAttributes=u(),m.insert=s().bind(null,"head"),m.domAPI=i(),m.insertStyleElement=h(),o()(y.A,m),y.A&&y.A.locals&&y.A.locals;var P=function(){return e=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.boardSize=8,this.container=null,this.boardEl=null,this.cells=[],this.cellClickListeners=[],this.cellEnterListeners=[],this.cellLeaveListeners=[],this.newGameListeners=[],this.saveGameListeners=[],this.loadGameListeners=[]},t=[{key:"bindToDOM",value:function(e){if(!(e instanceof HTMLElement))throw new Error("container is not HTMLElement");this.container=e}},{key:"drawUi",value:function(e){var t,n,r=this;this.checkBinding(),this.container.innerHTML='\n      <div class="controls">\n        <button data-id="action-restart" class="btn">New Game</button>\n        <button data-id="action-save" class="btn">Save Game</button>\n        <button data-id="action-load" class="btn">Load Game</button>\n      </div>\n      <div class="board-container">\n        <div data-id="board" class="board"></div>\n      </div>\n    ',this.newGameEl=this.container.querySelector("[data-id=action-restart]"),this.saveGameEl=this.container.querySelector("[data-id=action-save]"),this.loadGameEl=this.container.querySelector("[data-id=action-load]"),this.newGameEl.addEventListener("click",(function(e){return r.onNewGameClick(e)})),this.saveGameEl.addEventListener("click",(function(e){return r.onSaveGameClick(e)})),this.loadGameEl.addEventListener("click",(function(e){return r.onLoadGameClick(e)})),this.boardEl=this.container.querySelector("[data-id=board]"),this.boardEl.classList.add(e);for(var o=0;o<Math.pow(this.boardSize,2);o+=1){var a=document.createElement("div");a.classList.add("cell","map-tile","map-tile-".concat((t=o)<(n=this.boardSize)?0===t?"top-left":t===n-1?"top-right":"top":t>=n*(n-1)?t===n*(n-1)?"bottom-left":n*n===t+1?"bottom-right":"bottom":t%n===0?"left":(t+1)%n===0?"right":"center")),a.addEventListener("mouseenter",(function(e){return r.onCellEnter(e)})),a.addEventListener("mouseleave",(function(e){return r.onCellLeave(e)})),a.addEventListener("click",(function(e){return r.onCellClick(e)})),this.boardEl.appendChild(a)}this.cells=Array.from(this.boardEl.children)}},{key:"redrawPositions",value:function(e){var t,n=v(this.cells);try{for(n.s();!(t=n.n()).done;)t.value.innerHTML=""}catch(e){n.e(e)}finally{n.f()}var r,o,a=v(e);try{for(a.s();!(r=a.n()).done;){var i=r.value,c=this.boardEl.children[i.position],s=document.createElement("div");s.classList.add("character",i.character.type);var l=document.createElement("div");l.classList.add("health-level");var u=document.createElement("div");u.classList.add("health-level-indicator","health-level-indicator-".concat((o=i.character.health)<15?"critical":o<50?"normal":"high")),u.style.width="".concat(i.character.health,"%"),l.appendChild(u),s.appendChild(l),c.appendChild(s)}}catch(e){a.e(e)}finally{a.f()}}},{key:"addCellEnterListener",value:function(e){this.cellEnterListeners.push(e)}},{key:"addCellLeaveListener",value:function(e){this.cellLeaveListeners.push(e)}},{key:"addCellClickListener",value:function(e){this.cellClickListeners.push(e)}},{key:"addNewGameListener",value:function(e){this.newGameListeners.push(e)}},{key:"addSaveGameListener",value:function(e){this.saveGameListeners.push(e)}},{key:"addLoadGameListener",value:function(e){this.loadGameListeners.push(e)}},{key:"onCellEnter",value:function(e){e.preventDefault();var t=this.cells.indexOf(e.currentTarget);this.cellEnterListeners.forEach((function(e){return e.call(null,t)}))}},{key:"onCellLeave",value:function(e){e.preventDefault();var t=this.cells.indexOf(e.currentTarget);this.cellLeaveListeners.forEach((function(e){return e.call(null,t)}))}},{key:"onCellClick",value:function(e){var t=this.cells.indexOf(e.currentTarget);this.cellClickListeners.forEach((function(e){return e.call(null,t)}))}},{key:"onNewGameClick",value:function(e){e.preventDefault(),this.newGameListeners.forEach((function(e){return e.call(null)}))}},{key:"onSaveGameClick",value:function(e){e.preventDefault(),this.saveGameListeners.forEach((function(e){return e.call(null)}))}},{key:"onLoadGameClick",value:function(e){e.preventDefault(),this.loadGameListeners.forEach((function(e){return e.call(null)}))}},{key:"selectCell",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"yellow";this.deselectCell(e),this.cells[e].classList.add("selected","selected-".concat(t))}},{key:"deselectCell",value:function(e){var t,n=this.cells[e];(t=n.classList).remove.apply(t,function(e){return function(e){if(Array.isArray(e))return w(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||g(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(Array.from(n.classList).filter((function(e){return e.startsWith("selected")}))))}},{key:"showCellTooltip",value:function(e,t){this.cells[t].title=e}},{key:"hideCellTooltip",value:function(e){this.cells[e].title=""}},{key:"showDamage",value:function(e,t){var n=this;return new Promise((function(r){var o=n.cells[e],a=document.createElement("span");a.textContent=t,a.classList.add("damage"),o.appendChild(a),a.addEventListener("animationend",(function(){o.removeChild(a),r()}))}))}},{key:"setCursor",value:function(e){this.boardEl.style.cursor=e}},{key:"checkBinding",value:function(){if(null===this.container)throw new Error("GamePlay not bind to DOM")}}],n=[{key:"showError",value:function(e){alert(e)}},{key:"showMessage",value:function(e){alert(e)}}],t&&k(e.prototype,t),n&&k(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,n}();const S="prairie",O="desert",L="arctic",j="mountain";function E(e){return E="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},E(e)}function x(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,T(r.key),r)}}function T(e){var t=function(e){if("object"!=E(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=E(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==E(t)?t:t+""}var R=function(){return e=function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"generic";if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.level=t,this.attack=0,this.defence=0,this.health=50,this.moveRange=0,this.attackRange=0,this.type=n,(this instanceof e?this.constructor:void 0)==e)throw"Character() is prohibited"},(t=[{key:"levelUp",value:function(){this.level+=1,this.increaseCharacteristics()}},{key:"increaseCharacteristics",value:function(){this.health+=80,this.health>100&&(this.health=100),this.attack=Math.floor(Math.max(this.attack,this.attack*(80+this.health)/100)),this.defence=Math.floor(Math.max(this.defence,this.defence*(80+this.health)/100))}}])&&x(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}();function G(e){return G="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},G(e)}function I(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(I=function(){return!!e})()}function M(e){return M=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},M(e)}function U(e,t){return U=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},U(e,t)}var _=function(e){function t(e){var n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=function(e,t,n){return t=M(t),function(e,t){if(t&&("object"==G(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,I()?Reflect.construct(t,n||[],M(e).constructor):t.apply(e,n))}(this,t,[e,"bowman"])).attack=25,n.defence=25,n.moveRange=2,n.attackRange=2;for(var r=1;r<e;++r)n.increaseCharacteristics();return n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&U(e,t)}(t,e),n=t,Object.defineProperty(n,"prototype",{writable:!1}),n;var n}(R);function $(e){return $="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},$(e)}function A(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(A=function(){return!!e})()}function z(e){return z=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},z(e)}function D(e,t){return D=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},D(e,t)}var B=function(e){function t(e){var n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=function(e,t,n){return t=z(t),function(e,t){if(t&&("object"==$(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,A()?Reflect.construct(t,n||[],z(e).constructor):t.apply(e,n))}(this,t,[e,"swordsman"])).attack=40,n.defence=10,n.moveRange=4,n.attackRange=1;for(var r=1;r<e;++r)n.increaseCharacteristics();return n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&D(e,t)}(t,e),n=t,Object.defineProperty(n,"prototype",{writable:!1}),n;var n}(R);function N(e){return N="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},N(e)}function F(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(F=function(){return!!e})()}function q(e){return q=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},q(e)}function H(e,t){return H=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},H(e,t)}var W=function(e){function t(e){var n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=function(e,t,n){return t=q(t),function(e,t){if(t&&("object"==N(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,F()?Reflect.construct(t,n||[],q(e).constructor):t.apply(e,n))}(this,t,[e,"magician"])).attack=10,n.defence=40,n.moveRange=1,n.attackRange=4;for(var r=1;r<e;++r)n.increaseCharacteristics();return n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&H(e,t)}(t,e),n=t,Object.defineProperty(n,"prototype",{writable:!1}),n;var n}(R);function J(e){return J="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},J(e)}function Y(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(Y=function(){return!!e})()}function Q(e){return Q=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Q(e)}function K(e,t){return K=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},K(e,t)}var V=function(e){function t(e){var n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=function(e,t,n){return t=Q(t),function(e,t){if(t&&("object"==J(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,Y()?Reflect.construct(t,n||[],Q(e).constructor):t.apply(e,n))}(this,t,[e,"vampire"])).attack=25,n.defence=25,n.moveRange=2,n.attackRange=2;for(var r=1;r<e;++r)n.increaseCharacteristics();return n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&K(e,t)}(t,e),n=t,Object.defineProperty(n,"prototype",{writable:!1}),n;var n}(R);function X(e){return X="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},X(e)}function Z(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(Z=function(){return!!e})()}function ee(e){return ee=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},ee(e)}function te(e,t){return te=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},te(e,t)}var ne=function(e){function t(e){var n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=function(e,t,n){return t=ee(t),function(e,t){if(t&&("object"==X(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,Z()?Reflect.construct(t,n||[],ee(e).constructor):t.apply(e,n))}(this,t,[e,"undead"])).attack=40,n.defence=10,n.moveRange=4,n.attackRange=1;for(var r=1;r<e;++r)n.increaseCharacteristics();return n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&te(e,t)}(t,e),n=t,Object.defineProperty(n,"prototype",{writable:!1}),n;var n}(R);function re(e){return re="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},re(e)}function oe(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(oe=function(){return!!e})()}function ae(e){return ae=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},ae(e)}function ie(e,t){return ie=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},ie(e,t)}var ce=function(e){function t(e){var n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=function(e,t,n){return t=ae(t),function(e,t){if(t&&("object"==re(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,oe()?Reflect.construct(t,n||[],ae(e).constructor):t.apply(e,n))}(this,t,[e,"daemon"])).attack=10,n.defence=10,n.moveRange=1,n.attackRange=4;for(var r=1;r<e;++r)n.increaseCharacteristics();return n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&ie(e,t)}(t,e),n=t,Object.defineProperty(n,"prototype",{writable:!1}),n;var n}(R);const se={bowman:_,swordsman:B,magician:W,vampire:V,undead:ne,daemon:ce};function le(e){return le="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},le(e)}function ue(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,fe(r.key),r)}}function fe(e){var t=function(e){if("object"!=le(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=le(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==le(t)?t:t+""}var he=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.characters=t}return t=e,n=[{key:"fromObject",value:function(t){for(var n=[],r=0;r<t.characters.length;++r){var o=new se[t.characters[r].type](t.characters[r].level);o.health=t.characters[r].health,n.push(o)}return new e(n)}}],null&&ue(t.prototype,null),n&&ue(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,n}();function pe(){var e,t,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",o=n.toStringTag||"@@toStringTag";function a(n,r,o,a){var s=r&&r.prototype instanceof c?r:c,l=Object.create(s.prototype);return de(l,"_invoke",function(n,r,o){var a,c,s,l=0,u=o||[],f=!1,h={p:0,n:0,v:e,a:p,f:p.bind(e,4),d:function(t,n){return a=t,c=0,s=e,h.n=n,i}};function p(n,r){for(c=n,s=r,t=0;!f&&l&&!o&&t<u.length;t++){var o,a=u[t],p=h.p,d=a[2];n>3?(o=d===r)&&(s=a[(c=a[4])?5:(c=3,3)],a[4]=a[5]=e):a[0]<=p&&((o=n<2&&p<a[1])?(c=0,h.v=r,h.n=a[1]):p<d&&(o=n<3||a[0]>r||r>d)&&(a[4]=n,a[5]=r,h.n=d,c=0))}if(o||n>1)return i;throw f=!0,r}return function(o,u,d){if(l>1)throw TypeError("Generator is already running");for(f&&1===u&&p(u,d),c=u,s=d;(t=c<2?e:s)||!f;){a||(c?c<3?(c>1&&(h.n=-1),p(c,s)):h.n=s:h.v=s);try{if(l=2,a){if(c||(o="next"),t=a[o]){if(!(t=t.call(a,s)))throw TypeError("iterator result is not an object");if(!t.done)return t;s=t.value,c<2&&(c=0)}else 1===c&&(t=a.return)&&t.call(a),c<2&&(s=TypeError("The iterator does not provide a '"+o+"' method"),c=1);a=e}else if((t=(f=h.n<0)?s:n.call(r,h))!==i)break}catch(t){a=e,c=1,s=t}finally{l=1}}return{value:t,done:f}}}(n,o,a),!0),l}var i={};function c(){}function s(){}function l(){}t=Object.getPrototypeOf;var u=[][r]?t(t([][r]())):(de(t={},r,(function(){return this})),t),f=l.prototype=c.prototype=Object.create(u);function h(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,l):(e.__proto__=l,de(e,o,"GeneratorFunction")),e.prototype=Object.create(f),e}return s.prototype=l,de(f,"constructor",l),de(l,"constructor",s),s.displayName="GeneratorFunction",de(l,o,"GeneratorFunction"),de(f),de(f,o,"Generator"),de(f,r,(function(){return this})),de(f,"toString",(function(){return"[object Generator]"})),(pe=function(){return{w:a,m:h}})()}function de(e,t,n,r){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}de=function(e,t,n,r){if(t)o?o(e,t,{value:n,enumerable:!r,configurable:!r,writable:!r}):e[t]=n;else{var a=function(t,n){de(e,t,(function(e){return this._invoke(t,n,e)}))};a("next",0),a("throw",1),a("return",2)}},de(e,t,n,r)}var ye=pe().m(me);function me(e,t){var n,r;return pe().w((function(o){for(;;)switch(o.n){case 0:return n=e[Math.floor(Math.random()*e.length)],r=Math.floor(Math.random()*t)+1,o.n=1,new n(r);case 1:o.n=0;break;case 2:return o.a(2)}}),ye)}function be(e,t,n){var r=me(e,t),o=Array.from({length:n},(function(){return r.next().value}));return new he(o)}function ve(e){return ve="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ve(e)}function ge(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,we(r.key),r)}}function we(e){var t=function(e){if("object"!=ve(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=ve(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==ve(t)?t:t+""}var ke=function(){function e(t,n){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),!(t instanceof R))throw new Error("character must be instance of Character or its children");if("number"!=typeof n)throw new Error("position must be a number");this.character=t,this.position=n}return t=e,n=[{key:"fromObject",value:function(t){var n=new se[t.character.type](t.character.level);return n.health=t.character.health,new e(n,t.position)}}],null&&ge(t.prototype,null),n&&ge(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,n}();const Ce="auto",Pe="pointer",Se="crosshair",Oe="not-allowed";function Le(e){return Le="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Le(e)}function je(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,a,i,c=[],s=!0,l=!1;try{if(a=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;s=!1}else for(;!(s=(r=a.call(n)).done)&&(c.push(r.value),c.length!==t);s=!0);}catch(e){l=!0,o=e}finally{try{if(!s&&null!=n.return&&(i=n.return(),Object(i)!==i))return}finally{if(l)throw o}}return c}}(e,t)||Ee(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ee(e,t){if(e){if("string"==typeof e)return xe(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?xe(e,t):void 0}}function xe(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function Te(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,Re(r.key),r)}}function Re(e){var t=function(e){if("object"!=Le(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=Le(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==Le(t)?t:t+""}var Ge=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.gamePlay=t,this.stateService=n,this.playerableTypes=["bowman","swordsman","magician"],this.gameLevel=1,this.maxGameLevel=4,this.isGameOver=!1,this.countScores=0,this.isPlayerTurn=!0,this.theme=S,this.selectedPositionedCharacter=null,this.selectedCell=null,this.cursor=Ce,this.teamsInfo={teams:{},positionedCharacters:{}}}return t=e,n=[{key:"init",value:function(){this.unsubscribeOnEvents(),this.loadGameState(),this.initLevel(),this.subscribeOnEvents()}},{key:"loadGameState",value:function(){this.state=this.stateService.load(),this.state&&this.restoreGameState()}},{key:"restoreGameState",value:function(){this.resetTeams(),this.isPlayerTurn=this.state.isPlayerTurn,this.gameLevel=this.state.gameLevel,this.countScores=this.state.countScores,this.isGameOver=this.state.isGameOver,this.theme=this.state.theme;for(var e=0,t=Object.entries(this.state.teamsInfo.teams);e<t.length;e++){var n=je(t[e],2),r=n[0],o=n[1];this.teamsInfo.teams[r]=he.fromObject(o)}for(var a=0,i=Object.entries(this.state.teamsInfo.positionedCharacters);a<i.length;a++){var c=je(i[a],2),s=c[0],l=c[1];this.teamsInfo.positionedCharacters[s]=ke.fromObject(l)}}},{key:"drawGameUI",value:function(){this.gamePlay.drawUi(this.theme)}},{key:"initLevel",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];e&&this.handleLevelUp(),this.isGameOver||(this.setThemeByLevel(),this.resetSelectionState(),this.state||this.resetTeams(e),this.drawGameUI(),this.initTeams(e))}},{key:"handleLevelUp",value:function(){++this.gameLevel,this.gameLevel>this.maxGameLevel&&this.gameOver(!0)}},{key:"setThemeByLevel",value:function(){var e={1:S,2:O,3:L,4:j};this.theme=e[this.gameLevel]||S}},{key:"resetSelectionState",value:function(){this.selectedPositionedCharacter=null,this.selectedCell=null,this.cursor=Ce}},{key:"resetTeams",value:function(e){e?this.teamsInfo.positionedCharacters={}:this.teamsInfo={teams:{},positionedCharacters:{}},this.isPlayerTurn=!0}},{key:"initTeams",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.state||(this.generateTeams(e),this.positionTeams()),this.redrawPositions()}},{key:"redrawPositions",value:function(){this.gamePlay.redrawPositions(Object.values(this.teamsInfo.positionedCharacters))}},{key:"generateTeams",value:function(e){for(var t=0;t<2;t++)this.generateTeam(t,e)}},{key:"generateTeam",value:function(e,t){var n=[_,B,W],r=[V,ne,ce];0===e?t?this.levelUpTeam(this.teamsInfo.teams[e]):this.teamsInfo.teams[e]=be(n,this.gameLevel,2):this.teamsInfo.teams[e]=be(r,this.gameLevel,2)}},{key:"levelUpTeam",value:function(e){e.characters.forEach((function(e){return e.levelUp()}))}},{key:"positionTeams",value:function(){for(var e=0,t=Object.entries(this.teamsInfo.teams);e<t.length;e++){var n=je(t[e],2),r=n[0],o=n[1],a=this.generatePositionsForTeam(o,r);this.createPositionedCharacters(o,a)}}},{key:"generatePositionsForTeam",value:function(e,t){for(var n=[],r=this.getPositionLimits(t),o=0;o<e.characters.length;o++){var a=void 0;do{var i=this.getRandomInt(r.rows.min,r.rows.max),c=this.getRandomInt(r.cols.min,r.cols.max);a=i*this.gamePlay.boardSize+c}while(n.includes(a));n.push(a)}return n}},{key:"getPositionLimits",value:function(e){return 0==e?{rows:{min:0,max:this.gamePlay.boardSize-1},cols:{min:0,max:1}}:{rows:{min:1,max:this.gamePlay.boardSize-1},cols:{min:this.gamePlay.boardSize-2,max:this.gamePlay.boardSize-1}}}},{key:"createPositionedCharacters",value:function(e,t){var n=this;e.characters.forEach((function(e,r){n.teamsInfo.positionedCharacters[t[r]]=new ke(e,t[r])}))}},{key:"getRandomInt",value:function(e,t){return Math.floor(Math.random()*(t-e+1))+e}},{key:"subscribeOnEvents",value:function(){this.gamePlay.addCellEnterListener(this.onCellEnter.bind(this)),this.gamePlay.addCellLeaveListener(this.onCellLeave.bind(this)),this.gamePlay.addCellClickListener(this.onCellClick.bind(this)),this.gamePlay.addNewGameListener(this.onNewGameClick.bind(this)),this.gamePlay.addSaveGameListener(this.onSaveGameClick.bind(this)),this.gamePlay.addLoadGameListener(this.onLoadGameClick.bind(this))}},{key:"unsubscribeOnEvents",value:function(){this.gamePlay.cellClickListeners=[],this.gamePlay.cellEnterListeners=[],this.gamePlay.cellLeaveListeners=[],this.gamePlay.newGameListeners=[],this.gamePlay.saveGameListeners=[],this.gamePlay.loadGameListeners=[]}},{key:"isInAttackRange",value:function(e,t){if(!e)return!1;var n=je(this.getPositionCoordinates(e.position),2),r=n[0],o=n[1],a=je(this.getPositionCoordinates(t),2),i=a[0],c=a[1],s=Math.abs(i-r),l=Math.abs(c-o);return s<=e.character.attackRange&&l<=e.character.attackRange}},{key:"isInMoveRange",value:function(e,t){if(!e)return!1;var n=je(this.getPositionCoordinates(e.position),2),r=n[0],o=n[1],a=je(this.getPositionCoordinates(t),2),i=a[0],c=a[1],s=i===r||c===o||Math.abs(i-r)===Math.abs(c-o),l=Math.abs(i-r)<=e.character.moveRange&&Math.abs(c-o)<=e.character.moveRange;return s&&l}},{key:"getRowIndex",value:function(e){return Math.floor(e/this.gamePlay.boardSize)}},{key:"getColIndex",value:function(e){return e%this.gamePlay.boardSize}},{key:"getPosition",value:function(e,t){return e*this.gamePlay.boardSize+t}},{key:"getPositionCoordinates",value:function(e){return[this.getRowIndex(e),this.getColIndex(e)]}},{key:"doAttack",value:function(e,t){var n=this,r=this.calculateDamage(e,t);t.character.health-=r,this.gamePlay.showDamage(t.position,r).then((function(){n.handlePostAttackEffects(t)}))}},{key:"calculateDamage",value:function(e,t){return Math.max(e.character.attack-t.character.defence,.1*e.character.attack)}},{key:"handlePostAttackEffects",value:function(e){e.character.health<=0&&this.removeDeadCharacter(e),this.checkGameOver(),this.redrawPositions(),this.switchTurn()}},{key:"removeDeadCharacter",value:function(e){delete this.teamsInfo.positionedCharacters[e.position],this.gamePlay.hideCellTooltip(e.position),this.isPlayerTurn&&(this.resetSelectionState(),++this.countScores)}},{key:"checkGameOver",value:function(){var e=this;0===Object.values(this.teamsInfo.positionedCharacters).filter((function(t){return e.playerableTypes.includes(t.character.type)})).length&&this.gameOver(!1)}},{key:"gameOver",value:function(e){this.isGameOver=!0,P.showMessage(e?"You have won game! Your scores are ".concat(this.countScores):"You have lost!"),this.gamePlay.setCursor(Ce)}},{key:"switchTurn",value:function(){this.isPlayerTurn=!this.isPlayerTurn,this.isPlayerTurn||this.handleEnemyTurn()}},{key:"doMovement",value:function(e,t){this.moveCharacter(e,t),this.redrawPositions(),this.switchTurn()}},{key:"moveCharacter",value:function(e,t){delete this.teamsInfo.positionedCharacters[e.position],e.position=t,this.teamsInfo.positionedCharacters[t]=e}},{key:"handleEnemyTurn",value:function(){var e=this.getEnemies(),t=this.getPlayers();if(0!==e.length){var n=this.selectRandomEnemy(e);this.performEnemyAction(n,t)}else this.initLevel(!0)}},{key:"getEnemies",value:function(){var e=this;return Object.values(this.teamsInfo.positionedCharacters).filter((function(t){return!e.playerableTypes.includes(t.character.type)}))}},{key:"getPlayers",value:function(){var e=this;return Object.values(this.teamsInfo.positionedCharacters).filter((function(t){return e.playerableTypes.includes(t.character.type)}))}},{key:"selectRandomEnemy",value:function(e){return e[Math.floor(Math.random()*e.length)]}},{key:"performEnemyAction",value:function(e,t){var n=this.findClosestPlayer(e,t);if(this.isInAttackRange(e,n.position))this.doAttack(e,n);else{var r=this.calculateEnemyMovement(e,n);this.doMovement(e,r)}}},{key:"findClosestPlayer",value:function(e,t){var n,r=1/0,o=null,a=function(e){var t="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=Ee(e))){t&&(e=t);var n=0,r=function(){};return{s:r,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,i=!1;return{s:function(){t=t.call(e)},n:function(){var e=t.next();return a=e.done,e},e:function(e){i=!0,o=e},f:function(){try{a||null==t.return||t.return()}finally{if(i)throw o}}}}(t);try{for(a.s();!(n=a.n()).done;){var i=n.value,c=this.calculateDistance(e.position,i.position);c<r&&(r=c,o=i)}}catch(e){a.e(e)}finally{a.f()}return o}},{key:"calculateDistance",value:function(e,t){var n=je(this.getPositionCoordinates(e),2),r=n[0],o=n[1],a=je(this.getPositionCoordinates(t),2),i=a[0],c=a[1];return Math.sqrt(Math.pow(i-r,2)+Math.pow(c-o,2))}},{key:"calculateEnemyMovement",value:function(e,t){var n=je(this.getPositionCoordinates(e.position),2),r=n[0],o=n[1],a=je(this.getPositionCoordinates(t.position),2),i=a[0]-r,c=a[1]-o,s=Math.min(e.character.moveRange,this.calculateDistance(e.position,t.position)),l=Math.floor(3*Math.random()),u=r+Math.sign(i)*s,f=o+Math.sign(c)*s;switch(l){case 0:f=o;break;case 1:u=r;break;default:u=r,f=o}u=Math.floor(Math.max(0,Math.min(this.gamePlay.boardSize-1,u))),f=Math.floor(Math.max(0,Math.min(this.gamePlay.boardSize-1,f)));var h=this.getPosition(u,f);return this.teamsInfo.positionedCharacters[h]?e.position:h}},{key:"onCellClick",value:function(e){if(this.canProcessClick()){var t=this.teamsInfo.positionedCharacters[e];this.isPlayerCharacter(t)?this.handlePlayerCharacterSelection(e):this.cursor===Se?this.handleAttack(e):this.cursor===Pe?this.handleMovement(e):P.showError("Not allowed click"),this.switchCursor(e)}}},{key:"canProcessClick",value:function(){return this.isPlayerTurn&&!this.isGameOver}},{key:"isPlayerCharacter",value:function(e){return e&&this.playerableTypes.includes(e.character.type)}},{key:"handlePlayerCharacterSelection",value:function(e){this.selectedPositionedCharacter&&this.gamePlay.deselectCell(this.selectedPositionedCharacter.position),this.gamePlay.selectCell(e),this.selectedPositionedCharacter=this.teamsInfo.positionedCharacters[e]}},{key:"handleAttack",value:function(e){this.doAttack(this.selectedPositionedCharacter,this.teamsInfo.positionedCharacters[e]),this.deselectCells()}},{key:"handleMovement",value:function(e){var t=this.selectedPositionedCharacter;this.deselectCells(),this.doMovement(t,e)}},{key:"deselectCells",value:function(){this.gamePlay.deselectCell(this.selectedPositionedCharacter.position),this.gamePlay.deselectCell(this.selectedCell),this.selectedPositionedCharacter=null}},{key:"switchCursor",value:function(e){this.selectedPositionedCharacter?this.handleCursorWithSelection(e):this.handleCursorWithoutSelection(e),this.selectedCell=e,this.gamePlay.setCursor(this.cursor)}},{key:"handleCursorWithoutSelection",value:function(e){var t=this.teamsInfo.positionedCharacters[e];t?this.isPlayerCharacter(t)?this.cursor=Pe:this.cursor=Oe:this.cursor=Ce}},{key:"handleCursorWithSelection",value:function(e){this.selectedPositionedCharacter.position!==this.selectedCell&&this.gamePlay.deselectCell(this.selectedCell);var t=this.teamsInfo.positionedCharacters[e],n=t&&this.isPlayerCharacter(t),r=t&&!this.isPlayerCharacter(t);n?this.cursor=Pe:this.isInAttackRange(this.selectedPositionedCharacter,e)&&r?(this.cursor=Se,this.gamePlay.selectCell(e,"red")):this.isInMoveRange(this.selectedPositionedCharacter,e)&&!r?(this.cursor=Pe,this.gamePlay.selectCell(e,"green")):this.cursor=Oe}},{key:"onCellEnter",value:function(e){this.isGameOver||(this.switchCursor(e),this.showTooltipIfCharacterPresent(e))}},{key:"showTooltipIfCharacterPresent",value:function(t){var n=this.teamsInfo.positionedCharacters[t];n&&this.gamePlay.showCellTooltip(e.createInfoMessage(n.character),t)}},{key:"onCellLeave",value:function(e){this.isGameOver||this.gamePlay.hideCellTooltip(e)}},{key:"onNewGameClick",value:function(){this.resetGameState(),this.init()}},{key:"resetGameState",value:function(){this.isGameOver=!1,this.countScores=0,this.gameLevel=1,this.stateService.save(null)}},{key:"onSaveGameClick",value:function(){this.stateService.save(this.getCurrentGameState())}},{key:"getCurrentGameState",value:function(){return{gameLevel:this.gameLevel,countScores:this.countScores,isGameOver:this.isGameOver,teamsInfo:this.teamsInfo,theme:this.theme,isPlayerTurn:this.isPlayerTurn}}},{key:"onLoadGameClick",value:function(){this.init()}}],r=[{key:"createInfoMessage",value:function(e){var t=e.level,n=e.attack,r=e.defence,o=e.health;return"🎖".concat(t," ⚔").concat(n," 🛡").concat(r," ❤").concat(o)}}],n&&Te(t.prototype,n),r&&Te(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,n,r}();function Ie(e){return Ie="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ie(e)}function Me(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,Ue(r.key),r)}}function Ue(e){var t=function(e){if("object"!=Ie(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=Ie(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==Ie(t)?t:t+""}var _e=function(){return e=function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.storage=t},t=[{key:"save",value:function(e){this.storage.setItem("state",JSON.stringify(e))}},{key:"load",value:function(){try{return JSON.parse(this.storage.getItem("state"))}catch(e){throw new Error("Invalid state",e)}}}],t&&Me(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}(),$e=new P;$e.bindToDOM(document.querySelector("#game-container")),new Ge($e,new _e(localStorage)).init()})();